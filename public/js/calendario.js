"use strict";function inicializar_calculo_montos_reserva(){$(".montos_reserva").on("change keyup keydown",function(){var a=$(this).parents("form:first"),e=""!=$(a).find("#precio").val()?parseFloat($(a).find("#precio").val()):0,n=""!=$(a).find("#costos_adicionales").val()?parseFloat($(a).find("#costos_adicionales").val()):0,o=""!=$(a).find("#monto_anticipo").val()?parseFloat($(a).find("#monto_anticipo").val()):0,t=""!=$(a).find("#noches").val()?parseInt($(a).find("#noches").val()):0,r=0,i=0;r=e*t+n,o=o>r?0:o,i=r-o,$(a).find("#monto_total").val(r),$(a).find("#monto_anticipo").val(o),$(a).find("#monto_deuda_actual").val(i)}),$("input[name=comprobante]").on("change",function(a){$(this)[0].checked?$("#email").prop("disabled",!1):$("#email").prop("disabled",!0)})}function mostrar_campos(a){var e=$(a);e.removeClass("hide").show();var n=e.find(".form-control-mbt");n.attr("disabled",!1),$.each(n,function(a,e){$(e).attr("value",$(e).attr("valor_predeterminado")?$(e).attr("valor_predeterminado"):"")})}function ocultar_campos(a){var e=$(a);e.find(".form-control-mbt").attr("disabled",!0).val(""),e.hide()}function reiniciar_formulario_eventos(){var a=$("input[name=accion_calendario]:checked");a.length>0&&a.prop("checked",!1),$("#contenedor_formulario_calendario").empty()}function actualizarPreciosDiarios(){$(".contenedor_precio_calendario").empty();var a=$("#calendar").fullCalendar("getView"),e=a.el,n=moment(a.start).format("YYYY-MM-DD"),o=moment(a.end).format("YYYY-MM-DD"),t=$(".rutaObtenerPreciosPropiedad").attr("href");$.ajax({url:t,type:"get",headers:{"X-CSRF-TOKEN":$("input[name=_token]").val()},datatype:"json",data:{fecha_incio:n,fecha_fin:o},success:function(a){$(a.precios).each(function(a,n){var o=$(e).find(".fc-day.fc-widget-content[data-date="+n.fecha+"]"),t=o.find(".contenedor_precio_calendario"),r=ponerFormatoMonto(n.precio);0==t.length?o.append("<b class='contenedor_precio_calendario' >"+r+"</b>"):$(t).empty().append(r)})}})}function actualizarNochesMinimas(){$(".contenedor_noches_minimas_calendario").empty();var a=$("#calendar").fullCalendar("getView"),e=a.el,n=moment(a.start).format("YYYY-MM-DD"),o=moment(a.end).format("YYYY-MM-DD"),t=$(".rutaObtenerNochesPropiedad").attr("href");$.ajax({url:t,type:"get",headers:{"X-CSRF-TOKEN":$("input[name=_token]").val()},datatype:"json",data:{fecha_incio:n,fecha_fin:o},success:function(a){$(a.noches).each(function(a,n){var o=$(e).find(".fc-day.fc-widget-content[data-date="+n.fecha+"]"),t=o.find(".contenedor_noches_minimas_calendario"),r=ponerFormatoMonto(n.noches);0==t.length?o.append("<b class='contenedor_noches_minimas_calendario' >"+r+"</b>"):$(t).empty().append(r)})}})}function callback_form_eventos(a){var e=a.success,n=a.mensaje;e?($("#myModal").modal("hide"),$("#myModalEdit").modal("hide"),refrescar_eventos(),swal.close()):abrir_modal_error(n)}function remover_eventos(){$("#calendar").fullCalendar("removeEvents")}function eliminar_evento(a){abrir_modal_espera();var e=$(".rutaEliminarEventoCalendario").attr("href");$("input[name=_token]").val();$.ajax({url:e,type:"post",headers:{"X-CSRF-TOKEN":$("input[name=_token]").val()},data:{id:a},success:function(a){$("#myModalEdit").modal("hide"),refrescar_eventos(),swal.close()}})}function refrescar_eventos(){remover_eventos();var a=$(".rutaObtenerEventosCalendario").attr("href");$.ajax({url:a,type:"post",headers:{"X-CSRF-TOKEN":$("input[name=_token]").val()},datatype:"json",success:function(a){$("#calendar").fullCalendar("renderEvents",a.events),actualizarPreciosDiarios(),actualizarNochesMinimas()}})}function daysBetweenTwoDates(a,e){var n=(e-a)/864e5;return Math.round(n)}function solo_entero_positivo(a,e){var n=a.value,o=e.key,t=n+o;return!!(Number.isInteger(parseInt(t))&&t>0)&&(a.value=parseInt(n),!0)}function reemplazar(a,e,n){return n.split(a).join(e)}function ponerFormatoMonto(a){return numberFormat(parseInt(a),0,",",".")}function numberFormat(a,e,n,o){n=void 0!==n?n:".",o=void 0!==o?o:",";var t=a.toFixed(e).split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,o),t.join(n)}function inicializar_date_pickers_calendario(a){var e=$("#calendar").fullCalendar("getCalendar"),n=e.moment().format("Z"),o=($("#checkin_").val(),$("#checkout_").val(),$(a).find("#fecha_inicio")),t=$(a).find("#fecha_fin"),r={autoClose:!0,singleDate:!0,showShortcuts:!1,singleMonth:!0,format:"DD/MM/YYYY HH:mm:ss",language:"es",setValue:function(e){var r=$(this).attr("id"),i=$.fullCalendar.moment(e,"DD/MM/YYYY HH:mm:ss"),l=$.fullCalendar.moment(i).format("DD/MM/YYYY HH:mm:ss"),c=$.fullCalendar.moment(i).format("YYYY-MM-DD HH:mm:ss")+n,d=$(a).find("#"+r).val(),s=$(a).find("#"+r+"_formato").val();$(a).find("#"+r).val(l),$(a).find("#"+r+"_formato").val(c),o.val()>t.val()&&($(a).find("#"+r).val(d),$(a).find("#"+r+"_formato").val(s));var m=$.fullCalendar.moment(o.val(),"DD/MM/YYYY"),f=$.fullCalendar.moment(t.val(),"DD/MM/YYYY"),_=f.diff(m,"days");$(a).find("#noches").val(_)}};o.dateRangePicker(r),t.dateRangePicker(r),$(o).on("keydown keyup",function(){return!1}),$(t).on("keydown keyup",function(){return!1})}function agregarEvento(){var a,e=$("#titulo").val(),n=$.fullCalendar.moment.utc($("#fecha_inicio_formato").val()),o=$.fullCalendar.moment.utc($("#fecha_fin_formato").val());""==e?alert("Debes Indicar un titulo"):(a={title:e,start:n,end:o,allDay:!1},$("#calendar").fullCalendar("renderEvent",a,!0),$("#calendar").fullCalendar("unselect"),$("#myModal").modal("toggle"))}$(document).ready(function(){var a=new Date;$("#calendar").fullCalendar({header:{left:"today",center:"prev, title, next",right:""},buttonText:{today:"hoy"},defaultDate:a,locale:"es",displayEventTime:!0,selectable:!0,eventLimit:!0,select:function(a,e){var n=$("#calendar").fullCalendar("getCalendar"),o=n.moment().format("Z"),t=$("#checkin_").val(),r=$("#checkout_").val(),i=moment(a),l=moment(e);i.time(t),l.time(r).subtract(1,"days"),$("#fecha_inicio_").val(i.format("DD/MM/YYYY HH:mm:ss")),$("#fecha_inicio_formato_").val(i.format("YYYY-MM-DD HH:mm:ss")+o),$("#fecha_fin_").val(l.format("DD/MM/YYYY HH:mm:ss")),$("#fecha_fin_formato_").val(l.format("YYYY-MM-DD HH:mm:ss")+o),$("#noches_").val(daysBetweenTwoDates(i,l)),reiniciar_formulario_eventos(),$("#myModal").modal()},eventRender:function(a,e){switch($(e).prepend("<div class='contenedor_imagen_evento' ></div>"),a.tipo){case"reservas":var n=$(".carpetaPublic").attr("href")+"img/Isotipo_MBT.gif";if(""==a.imagen){var o="<img class='imgen_evento' src='"+n+"' />";$(e).find(".contenedor_imagen_evento").append(o).addClass("borde_azul")}else{n="";var t="user_img/"+a.imagen,r=$("input[name=_token]").val(),i=$(".carpetaPublic").attr("href")+"obtener/url/storage/";$.ajax({url:i,type:"get",headers:{"X-CSRF-TOKEN":r},datatype:"json",data:{url:t},success:function(a){var n="<img class='imgen_evento' src='"+a+"' />";$(e).find(".contenedor_imagen_evento").append(n).addClass("borde_azul")}})}break;case"reservas_manuales":switch(a.motivo){case"reserva":$(e).find(".contenedor_imagen_evento").append("R").addClass("borde_verde");break;case"bloqueo":var o="<i class='fa fa-lock' aria-hidden='true'></i>";$(e).find(".contenedor_imagen_evento").append(o).addClass("borde_rojo")}break;case"precios_especificos":$(e).find(".contenedor_imagen_evento").remove(),"background"==a.rendering&&$(e).attr("style","background: transparent !important;")}},dayRender:function(a,e){moment(a).format("YYYY-MM-DD")},viewRender:function(a,e){var n=$(".fc-center h2").text(),o=n.split(" "),t=o[0],r=o[1];$(".fc-center h2").empty().append(t),$(".fc-right").empty().append(r),$("#calendar .leyenda_calendario").remove(),$(".fc-toolbar.fc-header-toolbar").after($("#contenedor_leyenda_calendario").html()),refrescar_eventos()},eventClick:function(a,e){$("#id_fc_evento_en_edicion_").val("");var n=$(".rutaObtenerFormularioCalendario").attr("href"),o=$("input[name=_token]").val(),t=a.pk,r=a.motivo,i=a.tipo;if("reservas"==a.tipo){c=$("#contenedor_formulario_reserva_mybooktravel"),c.empty(),$("#myModalShow").modal();var l="show";$.ajax({url:n,type:"get",headers:{"X-CSRF-TOKEN":o},datatype:"json",data:{tipo:i,motivo:r,modo:l,id:t},success:function(a){c.empty(),c.append(a)}})}if("reservas_manuales"==a.tipo){$("#id_fc_evento_en_edicion_").val(a._id),$("#myModalEdit").modal();var c=$("#contenedor_formulario_calendario_edicion");c.empty();var l="update";$.ajax({url:n,type:"get",headers:{"X-CSRF-TOKEN":o},datatype:"json",data:{tipo:i,motivo:r,modo:l,id:t},success:function(a){c.append(a);var e=$("#calendar").fullCalendar("getCalendar"),n=e.moment().format("Z"),o=$(c).find("#fecha_inicio"),t=$(c).find("#fecha_inicio_formato"),r=Date.parse(o.val()),i=$.fullCalendar.moment(r),l=$.fullCalendar.moment(i).format("DD/MM/YYYY HH:mm:ss"),d=$.fullCalendar.moment(i).format("YYYY-MM-DD HH:mm:ss")+n;o.val(l),t.val(d);var s=$(c).find("#fecha_fin"),m=$(c).find("#fecha_fin_formato"),f=Date.parse(s.val()),_=$.fullCalendar.moment(f),u=$.fullCalendar.moment(_).format("DD/MM/YYYY HH:mm:ss"),v=$.fullCalendar.moment(_).format("YYYY-MM-DD HH:mm:ss")+n;s.val(u),m.val(v),inicializar_date_pickers_calendario(c),inicializarValidacionesGenerales(),inicializar_enviador_formularios(),inicializar_calculo_montos_reserva()}})}}}),$(".solo_entero_positivo").on("keypress",function(a){return solo_entero_positivo(this,a)}),$("input[name=accion_calendario]").on("change",function(a){var e=$(this).attr("tipo"),n=$(this).attr("motivo"),o=$(".rutaObtenerFormularioCalendario").attr("href"),t=$("#contenedor_formulario_calendario");t.empty(),abrir_modal_espera(),$.ajax({url:o,type:"get",headers:{"X-CSRF-TOKEN":$("input[name=_token]").val()},datatype:"json",data:{tipo:e,motivo:n,modo:"create"},success:function(a){t.empty(),t.append(a),$(t).find("#fecha_inicio").val($("#fecha_inicio_").val()),$(t).find("#fecha_inicio_formato").val($("#fecha_inicio_formato_").val()),$(t).find("#fecha_fin").val($("#fecha_fin_").val()),$(t).find("#fecha_fin_formato").val($("#fecha_fin_formato_").val()),$(t).find("#noches").val($("#noches_").val()),inicializar_date_pickers_calendario(t),inicializarValidacionesGenerales(),inicializar_enviador_formularios(),inicializar_calculo_montos_reserva(),swal.close()}})})});