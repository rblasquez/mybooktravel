"use strict";var Imagine=function(){var e='\n\t\t<div class="col-md-2 col-sm-4 col-xs-6 preview_image_container" id="unique_id"  >\n\t\t\t<div class="panel panel-default">\n\t\t\t\t<div class="panel-heading mbt_pt-0 mbt_pb-0 preview_image_header">\n\t\t\t\t\t<input type="radio" id="" class="main_image_input" name="main_image" >\n\t\t\t\t\t<label for="" class="make_main_image main_image_label mbt_mt-20" >Portada</label>\n\t\t\t\t</div>\n\t\t\t\t<div class="panel-body img_container preview_image_body">\n\t\t\t\t\t<figure>\n\t\t\t\t\t\t<preview_image ></preview_image>\n\t\t\t\t\t</figure>\n\t\t\t\t</div>\n\t\t\t\t<div class="panel-footer preview_image_footer">\n\t\t\t\t\t<div class="row">\n\t\t\t\t\t\t<div class="col-xs-4">\n\t\t\t\t\t\t\t<button type="button" class="btn btn-xs btn-default rotator counter_clockwise " title="Girar a la izquierda"><i class="fa fa-rotate-left"></i></button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="col-xs-4">\n\t\t\t\t\t\t\t<button type="button" class="btn btn-xs btn-default delete" title="Eliminar archivo"><i class="fa fa-trash-o text-danger" aria-hidden="true"></i></button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="col-xs-4">\n\t\t\t\t\t\t\t<button type="button" class="btn btn-xs btn-default rotator clockwise " title="Girar a la derecha"><i class="fa fa-rotate-right"></i></button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t',t=function(){return{start:function(e){var t=void 0!==e.containerSelector?e.containerSelector:"body",i=void 0!==e.fileInputSelector?e.fileInputSelector:"input[type='file']",n=void 0!==e.onSelect?e.onSelect:null,r=void 0!==e.onFinishSelect?e.onFinishSelect:null,o=void 0!==e.maxFiles?e.maxFiles:1,a=void 0!==e.maxFilesOnSelect?e.maxFilesOnSelect:null,l=(void 0!==e.initialPreviews&&e.initialPreviews,document.querySelector(t));l.insertAdjacentHTML("beforeend",'<input type="file" class=\'file_input\' multiple="multiple" accept=".png, .jpg, .jpeg" style="display:none;visibility:hidden;" >');var d=l.querySelector(".file_input");l.insertAdjacentHTML("beforeend",'\n\t\t<div class=" add_button col-xs-6 col-md-2 col-sm-3" >\n\t\t\t<button type="button" class="add_image"  >\n\t\t\t\t<i class="fa fa-plus" ></i>\n\t\t\t\tAgregar im√°genes\n\t\t\t</button>\n\t\t</div>\n\t\t'),l.querySelector(".add_button").addEventListener("click",function(e){d.click()}),l.querySelector(i).addEventListener("change",function(e){null!=n&&n(e.target.files);var i=l.querySelectorAll(".preview_image").length,d=o-i,c=null==a?e.target.files.length:Math.min(a,e.target.files.length);c=Math.min(c,d);for(var s=0;s<c;s++){var u=Imagine.previewer.createNewPreview({containerSelector:t});u.addEventListener("load",function(e){if(1!=this.getAttribute("loaded")&&(this.setAttribute("loaded",0),e==l.querySelectorAll(".preview_image[loaded='0']").length)){for(var t=l.querySelectorAll(".preview_image[loaded='0']"),i=0;i<t.length;i++)t[i].setAttribute("loaded",1);null!=r&&r()}}.bind(u,c));var v=e.target.files[s];Imagine.previewer.blobImageDataToBase64SrcDomImage({blobImageData:v,domImage:u,onFinish:function(e){}})}})},blobImageDataToBase64SrcDomImage:function(e){var t=e.blobImageData,i=e.domImage,n=e.onFinish,r=new window.FileReader;r.readAsDataURL(t),r.onloadend=function(){var e=r.result;i.src=e,i.setAttribute("encoded",1),n(i)}},createNewPreview:function(t){var i=void 0!==t.containerSelector?t.containerSelector:"body",n=t.imgAttributes?t.imgAttributes:null,r=document.querySelector(i),o=Date.now(),a=document.createElement("IMG");if(console.log(a),a.setAttribute("preview_id",o),a.classList.add("img-responsive"),a.classList.add("preview_image"),null!=n)for(var l in n)a.setAttribute(l,n[l]);var d=e.replace(/unique_id/g,o);r.querySelector(i+" .add_button").insertAdjacentHTML("beforebegin",d);var c=".preview_image_container[id='"+o+"']";return r.querySelector(c).querySelector("preview_image").appendChild(a),a},setInitialPreviews:function(e){for(var t=void 0!==e.containerSelector?e.containerSelector:"body",i=e.initialPreviews?e.initialPreviews:null,n=(document.querySelector(t),0);n<i.length;n++){var r=i[n];r.loaded=1,r.encoded=1,r.compressed=1,r.uploaded=2;Imagine.previewer.createNewPreview({containerSelector:t,imgAttributes:r}).setAttribute("previewed",1)}}}}(),i=function(){return{start:function(e){for(var t=void 0!==e.containerSelector?e.containerSelector:"body",i=void 0!==e.compressionLevel?e.compressionLevel:1,n=e.maxWidth?e.maxWidth:0,r=e.maxHeight?e.maxHeight:0,o=void 0!==e.newSrcTarget?e.newSrcTarget:"src",a=e.onfinishAllImages?e.onfinishAllImages:null,l=e.onFinishEveryImage?e.onFinishEveryImage:null,d=void 0!==e.outputFormat?e.outputFormat:"png",c=e.selector?e.selector:".preview_image",s=e.statusAttr?e.statusAttr:"compressed",u=document.querySelector(t),v=u.querySelectorAll(c),m=v.length,g=0;g<m;g++){var p=v[g],h=".preview_image[preview_id='"+p.getAttribute("preview_id")+"']",f="";if(g>0){f=".preview_image[preview_id='"+v[g-1].getAttribute("preview_id")+"']"}var b={compressionLevel:i,maxWidth:n,maxHeight:r,newSrcTarget:o,onFinish:l,outputFormat:d,selector:h};Imagine.helper.doWhen({condition:function(e,t){return 0==e||""!=t&&1==u.querySelector(t).getAttribute("compressed")}.bind({},g,f),action:function(e){Imagine.compressor.compress(e)}.bind({},b),milliseconds:10})}null!=a&&Imagine.helper.doWhen({condition:function(){return u.querySelectorAll(c+"["+s+"='1']").length==m},action:function(){a(c)}})},compress:function(e){var t=void 0!==e.compressionLevel?e.compressionLevel:1,i=e.maxWidth?e.maxWidth:0,n=e.maxHeight?e.maxHeight:0,r=void 0!==e.newSrcTarget?e.newSrcTarget:"src",o=void 0!==e.onFinish?e.onFinish:null,a=void 0!==e.outputFormat?e.outputFormat:"png",l=e.selector?e.selector:"img",d=e.statusAttr?e.statusAttr:"compressed",c=document.querySelector(l),s=c.getAttribute(d);if(c.addEventListener("load",function(){1!=this.getAttribute(d)&&(this.setAttribute(d,1),null!=o&&o(this))}),null==s||0==s){var u=c.naturalWidth,v=c.naturalHeight,m=v,g=u;if(0!=i||0!=n){var p=Imagine.compressor.getWidthAndHeigtScaled({originalWidth:u,originalHeight:v,maxWidth:i,maxHeight:n});g=p.newWidth,m=p.newHeight}var h=document.createElement("canvas"),f=h.getContext("2d");h.width=g,h.height=m,f.drawImage(c,0,0,g,m);var b=h.toDataURL("image/"+a,t);c.setAttribute(r,b),h.remove()}},getWidthAndHeigtScaled:function(e){var t=e.originalWidth,i=e.originalHeight,n=e.maxWidth,r=e.maxHeight,o=1,a=1,l=1;return t>n&&(a=t/n),i>r&&(l=i/r),o/=Math.max(a,l),{newWidth:t*o,newHeight:i*o}}}}(),n=function(){return{send:function(e){for(var t=void 0!==e.containerSelector?e.containerSelector:"body",i=void 0!==e.csrfToken?e.csrfToken:"",n=(void 0!==e.onStart&&e.onStart,void 0!==e.onFinishEveryImage?e.onFinishEveryImage:null),r=void 0!==e.onfinishAllImages?e.onfinishAllImages:null,o=void 0!==e.selector?e.selector:".preview_image",a=void 0!==e.url?e.url:"",l=document.querySelector(t),d=l.querySelectorAll(o+":not([uploaded='1']):not([uploaded='2'])"),c=d.length,s=0;s<c;s++){var u=d[s];u.setAttribute("uploaded",1);var v=(u.getAttribute("preview_id"),"");if(s>0){v=".preview_image[preview_id='"+d[s-1].getAttribute("preview_id")+"']"}var m={type:"POST",url:a,data:{image:u.src},csrfToken:i,onStart:function(){},onFinish:function(e){var t=this;t.setAttribute("uploaded","2"),null!=n&&n(e,t)}.bind(u)};Imagine.helper.doWhen({condition:function(e,t){return 0==e||""!=t&&2==l.querySelector(t).getAttribute("uploaded")}.bind({},s,v),action:function(e){Imagine.sender.ajax(e)}.bind({},m),milliseconds:10})}document.querySelectorAll(".preview_image").length;Imagine.helper.doWhen({condition:function(){return l.querySelectorAll(".preview_image").length==l.querySelectorAll(".preview_image[uploaded='2']").length},action:function(){null!=r&&r()},milliseconds:10})},ajax:function(e){var t=void 0!==e.type?e.type:"POST",i=void 0!==e.url?e.url:"",n=void 0!==e.data?e.data:"",r=void 0!==e.onStart?e.onStart:null,o=void 0!==e.onFinish?e.onFinish:null,a=void 0!==e.csrfToken?e.csrfToken:"";if(null!=r&&r(),""!=i&&""!=n){var l=null;l=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),l.onreadystatechange=function(){4==this.readyState&&null!=o&&o(this)},l.open(t,i,!0),l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),""!=a&&l.setRequestHeader("X-CSRF-Token",a),l.send(Imagine.helper.jsonToWwwFormUrlencoded({data:n}))}}}}();return{previewer:t,compressor:i,helper:function(){return{jsonToWwwFormUrlencoded:function(e){var t=e.data,i="";for(var n in t)""!=i&&(i+="&"),i+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]);return i},doWhen:function(e){var t=e.action,i=e.condition,n=void 0!==e.milliseconds?e.milliseconds:10,r=!1,o=setInterval(function(){(r=i())&&(t(),clearInterval(o))},n)}}}(),sender:n}}();